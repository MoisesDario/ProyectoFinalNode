version: 2.1
orbs:
    node: circleci/node@1.1.6
jobs:
    build-and-test:
        executor:
            name: node/default
        build:
            docker:
                - image: circleci/node:latest
            steps:
                - checkout
                - run: 
                    name: install dependencies
                - run:
                    name: update-npm
                - restore_cache:
                    keys:
                        # Find a cache corresponding to this specific package-lock.json checksum
                        # when this file is changed, this key will fail
                        - v1-npm-deps-{{ checksum "package-lock.json" }}
                        # Find the most recently generated cache used from any branch
                        - v1-npm-deps-        
                - run:
                    name: Run Unit Tests
                - run: 
                    name: test
                - run: |
                if [[ $(cat my_workspace/echo-output) == "Trying out workspaces" ]]; then
                echo "It worked!";
                else
                echo "Nope!"; exit 1
                fi
workflows:
    build-and-test:
        jobs:
            - build-and-test
